<%
return_message = {}
begin
    access_code = params[:access_code]
    refresh_token = nil
    # get the refresh token
    ret = `curl --location --request POST 'https://api.dropboxapi.com/oauth2/token' -u '#{DROPBOX_APP_KEY}:#{DROPBOX_APP_SECRET}' --data-urlencode 'grant_type=authorization_code' --data-urlencode 'code=#{access_code}'`
    h = JSON.parse(ret)
    if h.include? 'error'
        raise h['error_description']
    else
        refresh_token = h['refresh_token']
    end
    return_message[:status] = 'success'
    return_message[:refresh_token] = refresh_token 
rescue => e
    return_message[:status] = e.message
end
return return_message.to_json
%>